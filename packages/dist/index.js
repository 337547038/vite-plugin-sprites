/**
 * name: vite-plugin-sprites
 * version: 0.3.0
 */
import w from"fs";import u from"path";import P from"images";var $=(e,n,o)=>{let s=u.join(e,n,o);return u.relative(e,s)},C=(e={})=>{let{iconPath:n,root:o="./"}=e,s=u.join(o,n);if(!w.existsSync(s)){console.log(`icon\u56FE\u7247\u8DEF\u5F84\u4E0D\u5B58\u5728${s}`);return}w.readdir(s,(c,g)=>{if(c)throw c;let l=g.filter(r=>(r.endsWith(".jpg")||r.endsWith(".png"))&&r!=="sprites.png"),a=l.length,h=0,i=[];console.log(`\u68C0\u6D4B\u5230${a}\u4E2A\u56FE\u7247\u6587\u4EF6\uFF0C\u5F00\u59CB\u8FDB\u884C\u5408\u5E76~`),l.forEach(r=>{let p=$(o,n,r),f=P(p).size();i.push({path:p,width:f.width,height:f.height}),h++,h===a&&F(i,e)})})},F=(e,n)=>{let{root:o="./",savePath:s=n.savePath||n.iconPath,width:c=500,spacing:g=5,prefix:l="icon-"}=n;e.sort((t,d)=>t.height<d.height);let a=0,h=0,i=0;e.forEach(t=>{t.width+a+g>c?(h+=i+g,a=0,i=0,t.x=t.x||0):t.x=t.x||a,t.height>i&&(i=t.height),t.y=t.y||h,a+=t.width+g});let r=h+i,p=P(c,r),f=$(o,s,"sprites.png"),b=`[class*="${l}"]:before{content:"";background-image: url(./sprites.png); display:flex;align-items: center}
`;e.forEach(t=>{p.draw(P(t.path),t.x,t.y);let d=u.basename(t.path),m=d.substring(0,d.indexOf(".")),W=t.x?`-${t.x}px`:0,j=t.y?`-${t.y}px`:0;b+=`.${l+m}:before{background-position: ${W} ${j};width: ${t.width}px;height: ${t.height}px}
`});let S=$(o,s,"sprites.css");w.writeFile(`${S}`,b,function(t){if(t)throw t;console.log(`\u6210\u529F\u5199\u5165css\u6587\u4EF6\uFF1A${S}`)}),p.save(f),console.log(`\u6210\u529F\u5408\u5E76\u56FE\u7247\uFF1A${f}`)},x=C;var v=(e,n)=>{e.replace(/\\/g,"/").indexOf(n.iconPath)!==-1&&(e.endsWith(".jpg")||e.endsWith(".png"))&&x(n)},y=e=>{let n=e||{};return n.iconPath||(n.iconPath="/src/assets/icon"),{name:"vitePluginSprites",enforce:"pre",configResolved(o){n.root=o.root},buildStart(){x(n)},handleHotUpdate({file:o,server:s}){},configureServer(o){o.watcher.on("add",s=>{v(s,n)}),o.watcher.on("change",s=>{v(s,n)}),o.watcher.on("unlink",s=>{v(s,n)})}}};y.images=x;var N=y;export{N as default};
