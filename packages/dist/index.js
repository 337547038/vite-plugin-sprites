/**
 * name: vite-plugin-sprites
 * version: 0.2.1
 */
import u from"fs";import x from"path";import w from"images";var $=(s,n,o)=>{let e=x.join(s,n,o);return x.relative(s,e)},m=(s={})=>{let{iconPath:n="/src/assets/icon",root:o="./"}=s,e=x.join(o,n);if(!u.existsSync(e)){console.log(`icon\u56FE\u7247\u8DEF\u5F84\u4E0D\u5B58\u5728${e}`);return}u.readdir(e,(a,g)=>{if(a)throw a;let p=g.filter(h=>(h.endsWith(".jpg")||h.endsWith(".png"))&&h!=="sprites.png"),r=p.length,c=0,i=[];console.log(`\u68C0\u6D4B\u5230${r}\u4E2A\u56FE\u7247\u6587\u4EF6\uFF0C\u5F00\u59CB\u8FDB\u884C\u5408\u5E76~`),p.forEach(h=>{let l=$(o,n,h),f=w(l).size();i.push({path:l,width:f.width,height:f.height}),c++,c===r&&C(i,s)})})},C=(s,n)=>{let{root:o="./",savePath:e=n.iconPath||"/src/assets/icon",width:a=500,spacing:g=5,prefix:p="icon-"}=n;s.sort((t,d)=>t.height<d.height);let r=0,c=0,i=0;s.forEach(t=>{t.width+r+g>a?(c+=i+g,r=0,i=0,t.x=t.x||0):t.x=t.x||r,t.height>i&&(i=t.height),t.y=t.y||c,r+=t.width+g});let h=c+i,l=w(a,h),f=$(o,e,"sprites.png"),v=`[class*="${p}"]:before{content:"";background-image: url(./sprites.png); display:flex;align-items: center}
`;s.forEach(t=>{l.draw(w(t.path),t.x,t.y);let d=t.path.substring(0,t.path.indexOf(".")),S=t.x?`-${t.x}px`:0,j=t.y?`-${t.y}px`:0;v+=`.${p+d}:before{background-position: ${S} ${j};width: ${t.width}px;height: ${t.height}px}
`});let b=$(o,e,"sprites.css");u.writeFile(`${b}`,v,function(t){if(t)throw t;console.log(`\u6210\u529F\u5199\u5165css\u6587\u4EF6\uFF1A${b}`)}),l.save(f),console.log(`\u6210\u529F\u5408\u5E76\u56FE\u7247\uFF1A${f}`)},P=m;var y=s=>{let n=s||{};return{name:"vitePluginSprites",enforce:"pre",configResolved(o){n.root=o.root},buildStart(){P(n)}}};y.images=P;var z=y;export{z as default};
