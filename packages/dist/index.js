/**
 * name: vite-plugin-sprites
 * version: 0.2.0
 */
import b from"fs";import u from"path";import x from"images";var w=(s,e,o)=>{let h=u.join(s,e,o);return u.relative(s,h)},m=(s={})=>{let{iconPath:e="/src/assets/icon",root:o="./"}=s,h=u.join(o,e);b.readdir(h,(c,g)=>{if(c)throw c;let p=g.filter(r=>(r.endsWith(".jpg")||r.endsWith(".png"))&&r!=="sprites.png"),i=p.length,a=0,n=[];console.log(`\u68C0\u6D4B\u5230${i}\u4E2A\u56FE\u7247\u6587\u4EF6\uFF0C\u5F00\u59CB\u8FDB\u884C\u5408\u5E76~`),p.forEach(r=>{let l=w(o,e,r),f=x(l).size();n.push({path:l,width:f.width,height:f.height}),a++,a===i&&C(n,s)})})},C=(s,e)=>{let{root:o="./",savePath:h=e.iconPath||"/src/assets/icon",width:c=500,spacing:g=5,prefix:p="icon-"}=e;s.sort((t,d)=>t.height<d.height);let i=0,a=0,n=0;s.forEach(t=>{t.width+i+g>c?(a+=n+g,i=0,n=0,t.x=t.x||0):t.x=t.x||i,t.height>n&&(n=t.height),t.y=t.y||a,i+=t.width+g});let r=a+n,l=x(c,r),f=w(o,h,"sprites.png"),P=`[class*="${p}"]:before{content:"";background-image: url(./sprites.png); display:flex;align-items: center}
`;s.forEach(t=>{l.draw(x(t.path),t.x,t.y);let d=t.path.substring(0,t.path.indexOf(".")),S=t.x?`-${t.x}px`:0,j=t.y?`-${t.y}px`:0;P+=`.${p+d}:before{background-position: ${S} ${j};width: ${t.width}px;height: ${t.height}px}
`});let v=w(o,h,"sprites.css");b.writeFile(`${v}`,P,function(t){if(t)throw t;console.log(`\u6210\u529F\u5199\u5165css\u6587\u4EF6\uFF1A${v}`)}),l.save(f),console.log(`\u6210\u529F\u5408\u5E76\u56FE\u7247\uFF1A${f}`)},$=m;var y=s=>({name:"vitePluginSprites",enforce:"pre",configResolved(e){s.root=e.root},buildStart(){$(s)}});y.images=$;var z=y;export{z as default};
