/**
 * name: vite-plugin-sprites
 * version: 0.1.0
 */
import d from"fs";import u from"path";import{createCanvas as S,Image as C}from"canvas";var f,x=(e,n)=>{let r=u.join(f,e,n);return u.relative(f,r)},W=e=>{let{iconPath:n="/src/assets/icon"}=e,r=u.join(f,n);d.readdir(r,(c,g)=>{if(c)throw c;let p=g.filter(i=>(i.endsWith(".jpg")||i.endsWith(".png"))&&i!=="sprites.png"),h=p.length,a=0,s=[];p.forEach(i=>{let o=new C;o.onload=()=>{s.push({path:i,width:o.width,height:o.height,image:o}),a++,a===h&&j(s,e)},o.src=x(n,i)})})},j=(e,n)=>{let{savePath:r="/src/assets/icon",width:c=500,spacing:g=5,prefix:p="icon-"}=n;e.sort((t,l)=>t.height<l.height?-1:t.height>l.height?1:0);let h=0,a=0,s=0;e.forEach(t=>{t.width+h+g>c?(a+=s+g,h=0,s=0,t.x=t.x||0):t.x=t.x||h,t.height>s&&(s=t.height),t.y=t.y||a,h+=t.width+g});let i=a+s,o=S(c,i),$=o.getContext("2d"),w=x(r,"sprites.png"),b=`[class*="${p}"]:before{content:"";background-image: url(./sprites.png); display:flex;align-items: center}
`;e.forEach(t=>{$.drawImage(t.image,t.x,t.y,t.width,t.height);let l=t.path.substring(0,t.path.indexOf(".")),m=t.x?`-${t.x}px`:0,y=t.y?`-${t.y}px`:0;b+=`.${p+l}:before{background-position: ${m} ${y};width: ${t.width}px;height: ${t.height}px}
`});let v=x(r,"sprites.css");d.writeFile(`${v}`,b,function(t){if(t)throw t;console.log(`\u6210\u529F\u5199\u5165css\u6587\u4EF6:${v}`)});let P=d.createWriteStream(w);o.createPNGStream().pipe(P),P.on("finish",()=>console.log(`\u6210\u529F\u5408\u5E76\u56FE\u7247:${w}`))},E=e=>({name:"vitePluginSprites",enforce:"pre",configResolved(n){f=n.root},buildStart(){W(e)},load(){}}),L=E;export{L as default};
